<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”’ ä½¿ç”¨æ¬¡æ•°é™åˆ¶æµ‹è¯•</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; padding: 40px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .status { padding: 15px; border-radius: 8px; margin: 20px 0; font-weight: 600; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { background: #007bff; color: white; border: none; padding: 15px 30px; border-radius: 8px; cursor: pointer; font-size: 16px; margin: 10px; }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .test-area { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .usage-info { background: #e9ecef; padding: 15px; border-radius: 6px; margin: 10px 0; }
        h1 { color: #333; text-align: center; margin-bottom: 30px; }
        h2 { color: #495057; margin-top: 30px; }
        .limit-demo { background: linear-gradient(135deg, #dc3545, #c82333); color: white; padding: 20px; border-radius: 8px; margin: 20px 0; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”’ JELILIAN AI ä½¿ç”¨æ¬¡æ•°é™åˆ¶æµ‹è¯•</h1>
        
        <div class="limit-demo">
            <h3>ğŸ’ å•†ä¸šæ¨¡å¼å‡çº§</h3>
            <p>æ¯ä¸ªç”¨æˆ·ç°åœ¨åªèƒ½å…è´¹ä½¿ç”¨ <strong>1æ¬¡</strong> AIåŠŸèƒ½</p>
            <p>ä½¿ç”¨å®Œæ¯•åéœ€è¦è”ç³»ç®¡ç†å‘˜è·å–ä»˜è´¹ç‰ˆæœ¬</p>
        </div>
        
        <div id="currentStatus" class="status info">æ­£åœ¨æ£€æŸ¥å½“å‰ä½¿ç”¨çŠ¶æ€...</div>
        
        <h2>ğŸ“Š ä½¿ç”¨çŠ¶æ€æ£€æŸ¥</h2>
        <button onclick="checkUsageStatus()">æ£€æŸ¥æˆ‘çš„ä½¿ç”¨çŠ¶æ€</button>
        <div id="usageResult"></div>
        
        <h2>ğŸ§ª AIåŠŸèƒ½æµ‹è¯•</h2>
        <div class="test-area">
            <p>æµ‹è¯•AIå¯¹è¯åŠŸèƒ½ï¼ŒéªŒè¯ä½¿ç”¨æ¬¡æ•°é™åˆ¶ï¼š</p>
            <button onclick="testAIChat()" id="testButton">æµ‹è¯•AIå¯¹è¯ (æ¶ˆè€—1æ¬¡ä½¿ç”¨æœºä¼š)</button>
            <div id="testResult"></div>
        </div>
        
        <h2>ğŸ”„ é‡ç½®æµ‹è¯• (ä»…æµ‹è¯•ç”¨)</h2>
        <div class="test-area">
            <p style="color: #dc3545;">âš ï¸ æ³¨æ„ï¼šè¿™ä¸ªåŠŸèƒ½ä»…ç”¨äºæµ‹è¯•ï¼Œç”Ÿäº§ç¯å¢ƒä¸­ä¸ä¼šæœ‰é‡ç½®åŠŸèƒ½</p>
            <button onclick="simulateReset()" style="background: #dc3545;">æ¨¡æ‹Ÿé‡ç½®ä½¿ç”¨æ¬¡æ•°</button>
            <div id="resetResult"></div>
        </div>
        
        <h2>ğŸ’° ä»˜è´¹ç‰ˆæœ¬ä¿¡æ¯</h2>
        <div style="background: #e7f3ff; padding: 20px; border-radius: 8px;">
            <h4>å‡çº§åˆ°ä»˜è´¹ç‰ˆæœ¬è·å¾—ï¼š</h4>
            <ul>
                <li>âœ… æ— é™åˆ¶ä½¿ç”¨æ‰€æœ‰AIåŠŸèƒ½</li>
                <li>âœ… æ›´å¿«çš„å“åº”é€Ÿåº¦</li>
                <li>âœ… ä¼˜å…ˆå®¢æœæ”¯æŒ</li>
                <li>âœ… æ›´å¤šé«˜çº§åŠŸèƒ½</li>
                <li>âœ… æ— å¹¿å‘Šä½“éªŒ</li>
            </ul>
            <button onclick="contactAdmin()" style="background: #28a745;">è”ç³»ç®¡ç†å‘˜å‡çº§</button>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥çŠ¶æ€
        window.onload = function() {
            checkUsageStatus();
        };
        
        async function checkUsageStatus() {
            const statusEl = document.getElementById('currentStatus');
            const resultEl = document.getElementById('usageResult');
            
            statusEl.textContent = 'æ­£åœ¨æ£€æŸ¥ä½¿ç”¨çŠ¶æ€...';
            statusEl.className = 'status info';
            
            try {
                const response = await fetch(API_BASE + '/usage');
                const data = await response.json();
                
                if (data.success && data.usage) {
                    const usage = data.usage;
                    
                    let statusClass = 'success';
                    let statusText = '';
                    
                    if (usage.remaining <= 0) {
                        statusClass = 'error';
                        statusText = `âŒ å…è´¹é¢åº¦å·²ç”¨å®Œ (${usage.used}/${usage.limit})`;
                        document.getElementById('testButton').disabled = true;
                    } else if (usage.remaining === 1) {
                        statusClass = 'warning';
                        statusText = `âš ï¸ æœ€å ${usage.remaining} æ¬¡å…è´¹ä½¿ç”¨æœºä¼š`;
                    } else {
                        statusText = `âœ… å‰©ä½™ ${usage.remaining} æ¬¡å…è´¹ä½¿ç”¨`;
                    }
                    
                    statusEl.textContent = statusText;
                    statusEl.className = `status ${statusClass}`;
                    
                    resultEl.innerHTML = `
                        <div class="usage-info">
                            <h4>è¯¦ç»†ä½¿ç”¨ä¿¡æ¯ï¼š</h4>
                            <p><strong>å·²ä½¿ç”¨:</strong> ${usage.used} æ¬¡</p>
                            <p><strong>å‰©ä½™:</strong> ${usage.remaining} æ¬¡</p>
                            <p><strong>æ€»é™åˆ¶:</strong> ${usage.limit} æ¬¡</p>
                            ${usage.firstUse ? `<p><strong>é¦–æ¬¡ä½¿ç”¨:</strong> ${usage.firstUse}</p>` : ''}
                            ${usage.lastUse ? `<p><strong>æœ€åä½¿ç”¨:</strong> ${usage.lastUse}</p>` : ''}
                            <p><strong>ç”¨æˆ·ç±»å‹:</strong> ${usage.isNewUser ? 'æ–°ç”¨æˆ·' : 'å·²ä½¿ç”¨ç”¨æˆ·'}</p>
                        </div>
                    `;
                } else {
                    statusEl.textContent = 'âŒ æ— æ³•è·å–ä½¿ç”¨çŠ¶æ€';
                    statusEl.className = 'status error';
                }
            } catch (error) {
                statusEl.textContent = 'âŒ è¿æ¥æœåŠ¡å™¨å¤±è´¥: ' + error.message;
                statusEl.className = 'status error';
            }
        }
        
        async function testAIChat() {
            const resultEl = document.getElementById('testResult');
            const button = document.getElementById('testButton');
            
            button.disabled = true;
            button.textContent = 'æ­£åœ¨æµ‹è¯•...';
            
            resultEl.innerHTML = '<div class="status info">æ­£åœ¨å‘é€æµ‹è¯•æ¶ˆæ¯...</div>';
            
            try {
                const response = await fetch(API_BASE + '/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: 'ä½ å¥½ï¼Œè¿™æ˜¯ä¸€ä¸ªä½¿ç”¨æ¬¡æ•°é™åˆ¶æµ‹è¯•',
                        options: { maxTokens: 100 }
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultEl.innerHTML = `
                        <div class="status success">âœ… AIå¯¹è¯æµ‹è¯•æˆåŠŸï¼</div>
                        <div class="usage-info">
                            <h4>AIå›å¤:</h4>
                            <p>${data.text}</p>
                            <h4>ä½¿ç”¨æƒ…å†µæ›´æ–°:</h4>
                            <p>å·²ä½¿ç”¨: ${data.usage.used}/${data.usage.limit} æ¬¡</p>
                            <p>å‰©ä½™: ${data.usage.remaining} æ¬¡</p>
                            ${data.usage.remaining === 0 ? '<p style="color: #dc3545;"><strong>âš ï¸ å…è´¹é¢åº¦å·²ç”¨å®Œï¼</strong></p>' : ''}
                        </div>
                    `;
                    
                    // æ›´æ–°çŠ¶æ€
                    setTimeout(checkUsageStatus, 1000);
                } else {
                    if (response.status === 429) {
                        resultEl.innerHTML = `
                            <div class="status error">âŒ ä½¿ç”¨æ¬¡æ•°å·²è¾¾ä¸Šé™</div>
                            <div class="usage-info">
                                <h4>é™åˆ¶ä¿¡æ¯:</h4>
                                <p>${data.message}</p>
                                ${data.usageInfo ? `
                                    <p>å·²ä½¿ç”¨: ${data.usageInfo.used} æ¬¡</p>
                                    <p>é™åˆ¶: ${data.usageInfo.limit} æ¬¡</p>
                                    <p>é¦–æ¬¡ä½¿ç”¨: ${data.usageInfo.firstUse}</p>
                                ` : ''}
                                <h4>å‡çº§é€‰é¡¹:</h4>
                                <ul>
                                    ${data.upgradeInfo ? data.upgradeInfo.features.map(f => `<li>${f}</li>`).join('') : ''}
                                </ul>
                            </div>
                        `;
                    } else {
                        resultEl.innerHTML = `<div class="status error">âŒ æµ‹è¯•å¤±è´¥: ${data.error}</div>`;
                    }
                }
            } catch (error) {
                resultEl.innerHTML = `<div class="status error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            } finally {
                button.disabled = false;
                button.textContent = 'æµ‹è¯•AIå¯¹è¯ (æ¶ˆè€—1æ¬¡ä½¿ç”¨æœºä¼š)';
            }
        }
        
        function simulateReset() {
            const resultEl = document.getElementById('resetResult');
            resultEl.innerHTML = `
                <div class="status warning">
                    âš ï¸ æ³¨æ„ï¼šåœ¨çœŸå®ç¯å¢ƒä¸­ï¼Œç”¨æˆ·æ— æ³•é‡ç½®ä½¿ç”¨æ¬¡æ•°ã€‚<br>
                    è¿™ä¸ªåŠŸèƒ½ä»…ç”¨äºå¼€å‘æµ‹è¯•ã€‚<br>
                    ç”¨æˆ·éœ€è¦è”ç³»ç®¡ç†å‘˜è´­ä¹°ä»˜è´¹ç‰ˆæœ¬æ¥è·å¾—æ›´å¤šä½¿ç”¨æ¬¡æ•°ã€‚
                </div>
            `;
            
            // æ¨¡æ‹Ÿåˆ·æ–°é¡µé¢æ¥"é‡ç½®"ï¼ˆå®é™…ä¸Šæ˜¯å› ä¸ºä½¿ç”¨IP+UAè¯†åˆ«ç”¨æˆ·ï¼‰
            setTimeout(() => {
                if (confirm('æ˜¯å¦åˆ·æ–°é¡µé¢æ¥æ¨¡æ‹Ÿæ–°ç”¨æˆ·ï¼Ÿï¼ˆå®é™…ç¯å¢ƒä¸­ä¸ä¼šæœ‰æ­¤åŠŸèƒ½ï¼‰')) {
                    location.reload();
                }
            }, 2000);
        }
        
        function contactAdmin() {
            alert(`å‡çº§åˆ°JELILIAN AIä»˜è´¹ç‰ˆæœ¬ï¼š

ğŸ’° ä»·æ ¼æ–¹æ¡ˆï¼š
â€¢ ä¸ªäººç‰ˆ: Â¥29/æœˆ (æ— é™ä½¿ç”¨)
â€¢ ä¸“ä¸šç‰ˆ: Â¥99/æœˆ (é«˜çº§åŠŸèƒ½)  
â€¢ å¹´ä»˜ä¼˜æƒ : Â¥299/å¹´ æˆ– Â¥999/å¹´

ğŸ’³ æ”¯ä»˜æ–¹å¼ï¼š
â€¢ å¾®ä¿¡æ”¯ä»˜: æ‰«ç æ”¯ä»˜ (æ¨è)
â€¢ æ”¯ä»˜å®: æ‰«ç æ”¯ä»˜ (æ¨è)

ğŸ“ è”ç³»æ–¹å¼ï¼š
â€¢ å¾®ä¿¡: 18501935068
â€¢ é‚®ç®±: 18501935068@163.com

ğŸ’ ä»˜è´¹ç‰ˆæœ¬ç‰¹æƒï¼š
â€¢ æ— é™åˆ¶ä½¿ç”¨æ‰€æœ‰AIåŠŸèƒ½
â€¢ æ›´å¿«çš„å“åº”é€Ÿåº¦
â€¢ ä¼˜å…ˆå®¢æœæ”¯æŒ
â€¢ æ›´å¤šé«˜çº§åŠŸèƒ½

âš¡ æ‰«ç ä»˜æ¬¾åè¯·æˆªå›¾å‘é€ç»™å®¢æœï¼Œç«‹å³å¼€é€šï¼`);
        }
    </script>
</body>
</html>