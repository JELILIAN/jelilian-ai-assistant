<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JELILIAN AI - éƒ¨ç½²è°ƒè¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .loading { background: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 20px; margin: 10px 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        textarea { width: 100%; height: 100px; margin: 10px 0; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ”§ JELILIAN AI éƒ¨ç½²è°ƒè¯•å·¥å…·</h1>
    
    <div class="test-section">
        <h2>1. åŸºç¡€ä¿¡æ¯</h2>
        <p><strong>å½“å‰åœ°å€:</strong> <span id="currentUrl"></span></p>
        <p><strong>APIåŸºç¡€åœ°å€:</strong> <span id="apiBase"></span></p>
    </div>
    
    <div class="test-section" id="configTest">
        <h2>2. APIé…ç½®æµ‹è¯•</h2>
        <button class="btn-primary" onclick="testConfig()">æµ‹è¯• /api/config</button>
        <div id="configResult"></div>
    </div>
    
    <div class="test-section" id="usageTest">
        <h2>3. ä½¿ç”¨çŠ¶æ€æµ‹è¯•</h2>
        <button class="btn-primary" onclick="testUsage()">æµ‹è¯• /api/usage</button>
        <div id="usageResult"></div>
    </div>
    
    <div class="test-section" id="chatTest">
        <h2>4. AIèŠå¤©æµ‹è¯•</h2>
        <textarea id="testMessage" placeholder="è¾“å…¥æµ‹è¯•æ¶ˆæ¯ï¼Œä¾‹å¦‚ï¼šä½ å¥½"></textarea>
        <button class="btn-success" onclick="testChat()">æµ‹è¯• AI èŠå¤©</button>
        <div id="chatResult"></div>
    </div>
    
    <div class="test-section">
        <h2>5. é—®é¢˜è¯Šæ–­</h2>
        <button class="btn-primary" onclick="runFullDiagnosis()">è¿è¡Œå®Œæ•´è¯Šæ–­</button>
        <div id="diagnosisResult"></div>
    </div>

    <script>
        // åˆå§‹åŒ–é¡µé¢ä¿¡æ¯
        document.getElementById('currentUrl').textContent = window.location.href;
        const API_BASE = window.location.origin + '/api';
        document.getElementById('apiBase').textContent = API_BASE;
        
        // æµ‹è¯•APIé…ç½®
        async function testConfig() {
            const resultDiv = document.getElementById('configResult');
            resultDiv.innerHTML = '<p>ğŸ”„ æµ‹è¯•ä¸­...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/config`);
                const data = await response.json();
                
                if (response.ok && data.success) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h4>âœ… APIé…ç½®æµ‹è¯•æˆåŠŸ</h4>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h4>âŒ APIé…ç½®æµ‹è¯•å¤±è´¥</h4>
                            <p>çŠ¶æ€ç : ${response.status}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>âŒ APIé…ç½®è¯·æ±‚å¤±è´¥</h4>
                        <p>é”™è¯¯: ${error.message}</p>
                        <p>å¯èƒ½åŸå› : APIè·¯ç”±æœªæ­£ç¡®é…ç½®æˆ–æœåŠ¡å™¨é”™è¯¯</p>
                    </div>
                `;
            }
        }
        
        // æµ‹è¯•ä½¿ç”¨çŠ¶æ€
        async function testUsage() {
            const resultDiv = document.getElementById('usageResult');
            resultDiv.innerHTML = '<p>ğŸ”„ æµ‹è¯•ä¸­...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/usage`);
                const data = await response.json();
                
                if (response.ok && data.success) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h4>âœ… ä½¿ç”¨çŠ¶æ€æµ‹è¯•æˆåŠŸ</h4>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h4>âŒ ä½¿ç”¨çŠ¶æ€æµ‹è¯•å¤±è´¥</h4>
                            <p>çŠ¶æ€ç : ${response.status}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>âŒ ä½¿ç”¨çŠ¶æ€è¯·æ±‚å¤±è´¥</h4>
                        <p>é”™è¯¯: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // æµ‹è¯•AIèŠå¤©
        async function testChat() {
            const message = document.getElementById('testMessage').value.trim();
            const resultDiv = document.getElementById('chatResult');
            
            if (!message) {
                alert('è¯·è¾“å…¥æµ‹è¯•æ¶ˆæ¯');
                return;
            }
            
            resultDiv.innerHTML = '<p>ğŸ”„ AIå¤„ç†ä¸­ï¼Œè¯·ç¨å€™...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: message,
                        provider: 'qwen',
                        options: { maxTokens: 500 }
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h4>âœ… AIèŠå¤©æµ‹è¯•æˆåŠŸ</h4>
                            <p><strong>é—®é¢˜:</strong> ${message}</p>
                            <p><strong>AIå›ç­”:</strong></p>
                            <div style="background: white; padding: 15px; border-radius: 4px; margin: 10px 0;">
                                ${data.text.replace(/\n/g, '<br>')}
                            </div>
                            <p><strong>å“åº”æ—¶é—´:</strong> ${data.responseTime}ms</p>
                            <p><strong>ä½¿ç”¨æƒ…å†µ:</strong> ${data.usage ? JSON.stringify(data.usage) : 'æ— '}</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h4>âŒ AIèŠå¤©æµ‹è¯•å¤±è´¥</h4>
                            <p>çŠ¶æ€ç : ${response.status}</p>
                            <p>é”™è¯¯ä¿¡æ¯: ${data.error || 'æœªçŸ¥é”™è¯¯'}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>âŒ AIèŠå¤©è¯·æ±‚å¤±è´¥</h4>
                        <p>é”™è¯¯: ${error.message}</p>
                        <p>å¯èƒ½åŸå› : ç½‘ç»œé—®é¢˜ã€APIè·¯ç”±é”™è¯¯æˆ–æœåŠ¡å™¨é”™è¯¯</p>
                    </div>
                `;
            }
        }
        
        // è¿è¡Œå®Œæ•´è¯Šæ–­
        async function runFullDiagnosis() {
            const resultDiv = document.getElementById('diagnosisResult');
            resultDiv.innerHTML = '<p>ğŸ”„ è¿è¡Œå®Œæ•´è¯Šæ–­...</p>';
            
            const results = [];
            
            // æµ‹è¯•å„ä¸ªAPIç«¯ç‚¹
            const tests = [
                { name: 'APIé…ç½®', url: `${API_BASE}/config` },
                { name: 'ä½¿ç”¨çŠ¶æ€', url: `${API_BASE}/usage` }
            ];
            
            for (const test of tests) {
                try {
                    const response = await fetch(test.url);
                    const data = await response.json();
                    results.push({
                        name: test.name,
                        status: response.ok ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥',
                        code: response.status,
                        data: data
                    });
                } catch (error) {
                    results.push({
                        name: test.name,
                        status: 'âŒ é”™è¯¯',
                        error: error.message
                    });
                }
            }
            
            // æ˜¾ç¤ºè¯Šæ–­ç»“æœ
            let html = '<h4>ğŸ“Š è¯Šæ–­ç»“æœ:</h4>';
            results.forEach(result => {
                html += `
                    <div style="margin: 10px 0; padding: 10px; border-left: 4px solid ${result.status.includes('âœ…') ? '#28a745' : '#dc3545'};">
                        <strong>${result.name}:</strong> ${result.status}
                        ${result.code ? `<br>çŠ¶æ€ç : ${result.code}` : ''}
                        ${result.error ? `<br>é”™è¯¯: ${result.error}` : ''}
                    </div>
                `;
            });
            
            // æ·»åŠ å»ºè®®
            html += `
                <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 4px;">
                    <h4>ğŸ’¡ é—®é¢˜è§£å†³å»ºè®®:</h4>
                    <ul>
                        <li>å¦‚æœAPIé…ç½®å¤±è´¥: æ£€æŸ¥Vercelç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®</li>
                        <li>å¦‚æœèŠå¤©åŠŸèƒ½å¤±è´¥: æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ</li>
                        <li>å¦‚æœæ‰€æœ‰APIéƒ½å¤±è´¥: æ£€æŸ¥Verceléƒ¨ç½²æ˜¯å¦æˆåŠŸ</li>
                        <li>å¦‚æœéƒ¨åˆ†åŠŸèƒ½æ­£å¸¸: å¯èƒ½æ˜¯ç‰¹å®šAPIè·¯ç”±çš„é—®é¢˜</li>
                    </ul>
                </div>
            `;
            
            resultDiv.innerHTML = html;
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        window.onload = function() {
            setTimeout(() => {
                testConfig();
                testUsage();
            }, 1000);
        };
    </script>
</body>
</html>